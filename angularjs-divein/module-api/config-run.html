<!DOCTYPE html>
<html ng-app="myApp">
<head>
    <title>config-run</title>
	<meta charset="utf-8" />
    <link rel="stylesheet" href="../node_modules//bootstrap/dist/css/bootstrap.css" />
</head>
<body>    
    <script src="../node_modules/jquery/dist/jquery.js"></script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.js"></script>
    <script src="../node_modules/angular/angular.js"></script>
    <script>
        //signature:
        //run(initializationFun)
        //config(function(xxxProvider){})


        //NOTE: Only Provider and Constant can be injected into config block
        //Config block is useful to configure providers before they're actually created


        //run block: only instances and constants can be injected into run block
        //is useful to perform any kind of initialization after the objects instances registered in the module have already been created
        var myApp = angular.module('myApp', []);

        myApp.constant('COMPANY_NAME', 'ADVS');

        myApp.constant('INDUSTRY', 'IMS');

        myApp.value('customerList', ['IBM', 'GOOG', 'MSFT']);

        myApp.provider('customerManager', CustomerManager);

        myApp.config(function (COMPANY_NAME, INDUSTRY, customerManagerProvider) {
            customerManagerProvider.setPrefix(COMPANY_NAME);
            customerManagerProvider.setSuffix(INDUSTRY);
        });

        myApp.run(function (customerManager, customerList) {
            //customerList.push('ADVS');//it's OK to change value of custmerList
            console.log(customerManager.customers);
        });

        function CustomerManager() {
            var _prefix = '';
            var _suffix = '';

            return {
                setPrefix: function (prefix) {
                    _prefix = prefix;
                },

                setSuffix: function (suffix) {
                    _suffix = suffix;
                },

                $get: function (customerList) {//DI for customerList
                    var list = [];
                    angular.forEach(customerList, function (item) {
                        list.push(_prefix + '_' + item + '_' + _suffix);
                    });
                    return {
                        prefix: _prefix,
                        suffix: _suffix,
                        customers: list
                    };
                }
            };
        }

    </script>
</body>
</html>
